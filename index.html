<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>–í—ä–ª—à–µ–±–Ω–∏—è—Ç –ü–∞–∑–∏—Ç–µ–ª –Ω–∞ –ú–∏—Ä–∞</title>
    <style>
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1a2a6c, #050510 95%);
            font-family: 'Segoe UI', cursive, sans-serif;
            overflow: hidden; display: flex; align-items: center; justify-content: center; color: white;
        }

        /* –ú–ê–ì–ò–ß–ï–°–ö–ò –ù–ê–ß–ê–õ–ï–ù –ï–ö–†–ê–ù */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 5, 16, 0.96); z-index: 1000;
            display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(10px);
        }
        #intro-card {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 45px; border-radius: 45px; max-width: 750px;
            border: 3px solid #ffd319; box-shadow: 0 0 60px rgba(255, 211, 25, 0.4);
            text-align: center;
        }
        #intro-card h1 { color: #ffd319; font-size: 2.8em; margin-bottom: 15px; text-shadow: 0 0 20px rgba(255,211,25,0.5); }
        .mood-box { display: flex; justify-content: space-around; margin: 30px 0; gap: 15px; }
        .mood { padding: 15px; border-radius: 20px; font-size: 0.95em; width: 33%; border: 2px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2); }

        /* –í–ï–†–¢–ò–ö–ê–õ–ù–ê –õ–ï–ù–¢–ê */
        #breathing-track {
            position: fixed; left: 45px; top: 15%; width: 18px; height: 70%;
            background: rgba(255,255,255,0.05); border-radius: 25px;
            border: 1px solid rgba(255,255,255,0.1); overflow: hidden; opacity: 0; transition: 1.2s;
        }
        #breathing-fill { position: absolute; bottom: 0; width: 100%; height: 0%; background: #4facfe; transition: height 6s linear, background 1s; box-shadow: 0 0 20px #4facfe; }

        /* –ì–ï–†–û–ô */
        #main-stage { display: flex; flex-direction: column; align-items: center; position: relative; }
        #blob {
            position: relative; width: 320px; height: 320px;
            background: linear-gradient(135deg, #00f2fe 0%, #4facfe 100%);
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            box-shadow: 0 0 100px rgba(79, 172, 254, 0.4);
            animation: morph 8s ease-in-out infinite; transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; justify-content: center; align-items: center;
        }

  /* –†–™–¶–ï - –í–ï–†–°–ò–Ø –û–¢ –®–£–ú–û–ú–ï–†–ê */
#hero-wrap {
    position: relative;
    transition: all 4s ease-in-out; /* –ü–ª–∞–≤–Ω–∞ –ø—Ä–µ—Ö–æ–¥ –∑–∞ —Ü–µ–ª–∏—è –≥–µ—Ä–æ–π */
}

/* –†–™–¶–ï–¢–ï –û–¢ –®–£–ú–û–ú–ï–†–ê (–†–∞–∑–ª—è—Ç–∞ —Ñ–æ—Ä–º–∞ –∏ blur) */
#hero-wrap { position: relative; transition: all 4s ease-in-out; }

.arm {
    position: absolute; width: 110px; height: 170px; background: inherit; 
    border-radius: 50% 50% 40% 40% / 60% 60% 30% 30%;
    opacity: 0; transition: all 1s ease; z-index: 2; filter: blur(4px);
}
.arm-left { left: -75px; top: 25%; transform: rotate(-25deg); }
.arm-right { right: -75px; top: 25%; transform: rotate(25deg); }

.yoga-active .arm { opacity: 0.7; }

/* –ê–Ω–∏–º–∞—Ü–∏–∏ –∑–∞ –¥–≤–∏–∂–µ–Ω–∏–µ –Ω–∞ —Ä—ä—Ü–µ—Ç–µ */
.inhale .arm-left { transform: rotate(-80deg) translateY(-60px); }
.inhale .arm-right { transform: rotate(80deg) translateY(-60px); }
.exhale .arm-left { transform: rotate(20deg) translateY(60px); }
.exhale .arm-right { transform: rotate(-10deg) translateY(60px); }
        /* –õ–ò–¶–ï - –ü–ï–†–§–ï–ö–¢–ù–û –¶–ï–ù–¢–†–ò–†–ê–ù–ï */
        .face { position: relative; width: 160px; height: 120px; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .eyes { display: flex; justify-content: center; gap: 35px; width: 100%; }
        .eye { width: 42px; height: 50px; background: white; border-radius: 50%; position: relative; animation: blink 6.5s infinite; overflow: hidden; }
        .pupil { 
    width: 26px; 
    height: 26px; 
    background: #0f2027; 
    border-radius: 50%; 
    position: absolute; 
    top: 12px; 
    left: 8px; 
    animation: lookAround 11s infinite; 
}

/* –¢–æ–≤–∞ –¥–æ–±–∞–≤—è –º–∞–ª–∫–∞—Ç–∞ –±—è–ª–∞ —Ç–æ—á–∫–∞ (–±–ª—è—Å—ä–∫–∞) –≤ –æ–∫–æ—Ç–æ */
.pupil::after {
    content: '';
    position: absolute;
    top: 4px;
    left: 4px;
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
}
        /* –£–°–¢–ê–¢–ê - –¶–ï–ù–¢–†–ò–†–ê–ù–ê –° TRANSFORMS */
        .mouth { 
            position: absolute; bottom: 5px; left: 50%;
            width: 36px; height: 12px; 
            border-bottom: 6px solid #0f2027; border-radius: 0 0 40px 40px;
            transform: translateX(-50%); 
            transition: all 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .inhale .mouth { width: 26px; height: 2px; border-bottom: 4px solid #0f2027; border-radius: 0; bottom: 10px; }
        .exhale .mouth { width: 24px; height: 24px; border: 6px solid #0f2027; border-radius: 50%; background: #0a1a3a; bottom: -8px; }

        /* –¶–í–ï–¢–ù–ò –°–™–°–¢–û–Ø–ù–ò–Ø */
        .warning #blob { background: linear-gradient(135deg, #ffd319 0%, #ff901f 100%); box-shadow: 0 0 100px rgba(255, 211, 25, 0.5); }
        .danger #blob { background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%); animation: shake 0.2s infinite; box-shadow: 0 0 100px rgba(255, 8, 68, 0.6); }
        .meditation .eyes { opacity: 0.15; }

        #status-msg { margin-top: 55px; font-size: 32px; font-weight: bold; text-align: center; min-height: 90px; text-shadow: 0 5px 15px rgba(0,0,0,0.5); }

        /* –ü–û–ó–ò–¶–ò–û–ù–ò–†–ê–ù–ï –í –™–ì–õ–ò–¢–ï */
        #yoga-btn { 
            position: fixed; bottom: 45px; left: 45px; 
            padding: 22px 45px; font-size: 20px; border-radius: 60px; 
            background: #ffd319; color: #5c4b00; border: none; cursor: pointer;
            font-weight: bold; box-shadow: 0 10px 25px rgba(0,0,0,0.3); transition: 0.3s;
            display: none;
        }
        #yoga-btn:hover { transform: translateY(-5px) scale(1.05); }

        #author-tag { 
            position: fixed; bottom: 35px; right: 45px; 
            font-size: 16px; opacity: 0.8; font-style: italic;
            background: rgba(255,255,255,0.08); padding: 12px 24px; border-radius: 18px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        @keyframes morph { 0%, 100% { border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; } 50% { border-radius: 60% 40% 50% 60% / 55% 65% 45% 55%; } }
        @keyframes blink { 0%, 94%, 98%, 100% { transform: scaleY(1); } 96% { transform: scaleY(0.05); } }
        @keyframes lookAround { 0%, 100% { transform: translate(0, 0); } 30% { transform: translate(-5px, 2px); } 70% { transform: translate(5px, -2px); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-6px); } 75% { transform: translateX(6px); } }
    </style>
</head>
<body>

    <div id="overlay">
        <div id="intro-card">
            <h1>‚ú® –í—ä–ª—à–µ–±–Ω–∏—è—Ç –ü–∞–∑–∏—Ç–µ–ª</h1>
            <p style="font-size: 1.2em;">–î–æ–±—Ä–µ –¥–æ—à–ª–∏ –≤ —Å–≤–µ—Ç–∞ –Ω–∞ —Ç–∏—à–∏–Ω–∞—Ç–∞! –ü–∞–∑–∏—Ç–µ–ª—è—Ç –æ–±–∏—á–∞ —Å–ø–æ–∫–æ–π–Ω–∏—Ç–µ –¥–µ—Ü–∞.</p>
            
            <div class="mood-box">
                <div class="mood" style="border-color: #4facfe; box-shadow: 0 0 15px rgba(79,172,254,0.3);">
                    <strong style="color: #4facfe;">–°–ò–ù</strong><br>–©–∞—Å—Ç–ª–∏–≤ –µ –∏ –Ω–∞–±–ª—é–¥–∞–≤–∞ –≤ —Ç–∏—à–∏–Ω–∞—Ç–∞.
                </div>
                <div class="mood" style="border-color: #ffd319; box-shadow: 0 0 15px rgba(255,211,25,0.3);">
                    <strong style="color: #ffd319;">–ñ–™–õ–¢</strong><br>–£—Å–µ—â–∞ —à—É–º –∏ –∑–∞–ø–æ—á–≤–∞ –¥–∞ —Å–µ —Å—ä—Ä–¥–∏.
                </div>
                <div class="mood" style="border-color: #ff0844; box-shadow: 0 0 15px rgba(255,8,68,0.3);">
                    <strong style="color: #ff0844;">–ß–ï–†–í–ï–ù</strong><br>–ú–∞–≥–∏—è—Ç–∞ —Å–µ —Ä–∞–∑–≤–∞–ª—è! –¢—Ä—è–±–≤–∞ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ —Ç–∏—à–∏–Ω–∞.
                </div>
            </div>

            <p style="opacity: 0.9; margin-bottom: 25px;">–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ <strong>"–í—Ä–µ–º–µ –∑–∞ –ô–æ–≥–∞"</strong> –∑–∞ 3 –≤—ä–ª—à–µ–±–Ω–∏ –¥–∏—à–∞–Ω–∏—è.</p>
            
            <button style="background: #4facfe; color: white; padding: 20px 60px; font-size: 24px; border-radius: 60px; border: none; cursor: pointer; font-weight: bold; box-shadow: 0 10px 20px rgba(0,0,0,0.3);" onclick="initApp()">–°–™–ë–£–î–ò –ú–ê–ì–ò–Ø–¢–ê</button>
        </div>
    </div>

    <div id="breathing-track"><div id="breathing-fill"></div></div>

    <div id="main-stage">
    <div id="hero-wrap"> <div id="blob">
            <div class="arm arm-left"></div>
            <div class="arm arm-right"></div>
            <div class="face">
                <div class="eyes">
                    <div class="eye"><div class="pupil"></div></div>
                    <div class="eye"><div class="pupil"></div></div>
                </div>
                <div class="mouth"></div>
            </div>
        </div>
    </div>
    <div id="status-msg">–ü–∞–∑–∏—Ç–µ–ª—è—Ç –æ—á–∞–∫–≤–∞ –≤–∞—à–∞—Ç–∞ —Ç–∏—à–∏–Ω–∞...</div>
</div>

    <button id="yoga-btn">üßò –í–†–ï–ú–ï –ó–ê –ô–û–ì–ê</button>
    <div id="author-tag">–°—ä–∑–¥–∞–¥–µ–Ω–æ –æ—Ç: –î–æ—á–∫–∞ –ö—é—á—É–∫–æ–≤–∞</div>

    <audio id="music" loop src="fish_music.mp3"></audio>

<script>
    const blob = document.getElementById('blob');
    const stage = document.getElementById('main-stage');
    const msg = document.getElementById('status-msg');
    const music = document.getElementById('music');
    const yogaBtn = document.getElementById('yoga-btn');
    const breathFill = document.getElementById('breathing-fill');
    const breathTrack = document.getElementById('breathing-track');

    let audioCtx, analyser, dataArray;
    let noiseScore = 0, isYogaMode = false, yogaCycles = 0, isDeepMeditation = false;

    async function initApp() {
        document.getElementById('overlay').style.opacity = '0';
        setTimeout(() => document.getElementById('overlay').style.display = 'none', 500);
        yogaBtn.style.display = 'block';

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioCtx.createAnalyser();
            audioCtx.createMediaStreamSource(stream).connect(analyser);
            dataArray = new Uint8Array(analyser.frequencyBinCount);
            loop();
        } catch(e) { alert("–ú–æ–ª—è, —Ä–∞–∑—Ä–µ—à–µ—Ç–µ –¥–æ—Å—Ç—ä–ø –¥–æ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞!"); }
    }

    function loop() {
        if (!isYogaMode) {
            analyser.getByteFrequencyData(dataArray);
            let vol = dataArray.reduce((a,b) => a+b) / dataArray.length;
            if (vol > 35) noiseScore += (vol - 35) * 0.2;
            else if (noiseScore > 0) noiseScore -= 0.6;

            if (noiseScore > 100) { 
                stage.className = 'danger'; msg.textContent = "–®–®–®–¢! –ú–ê–ì–ò–Ø–¢–ê –ò–ó–ß–ï–ó–í–ê!";
            } else if (noiseScore > 35) { 
                stage.className = 'warning'; msg.textContent = "–ü–∞–∑–∏—Ç–µ–ª—è—Ç —Å–µ –¥—Ä–∞–∑–Ω–∏ –æ—Ç —à—É–º–∞... –î–∞ –≥–æ —É—Å–ø–æ–∫–æ–∏–º —Å –ø—ä–ª–Ω–∞ —Ç–∏—à–∏–Ω–∞.";
            } else {
                stage.className = ''; msg.textContent = "–ü—Ä–µ–∫—Ä–∞—Å–Ω–∞ —Ç–∏—à–∏–Ω–∞...";
            }
        } else if (isDeepMeditation) {
            if (music.volume > 0.02) music.volume -= 0.005;
            else { music.pause(); isYogaMode = false; yogaBtn.textContent = "üßò –í–†–ï–ú–ï –ó–ê –ô–û–ì–ê"; }
        }
        requestAnimationFrame(loop);
    }

    yogaBtn.onclick = function() {
        if (isDeepMeditation) return;
        if (!isYogaMode) {
            isYogaMode = true; yogaCycles = 0; isDeepMeditation = false; noiseScore = 0;
            music.volume = 1; music.play();
            stage.classList.add('yoga-active');
            breathTrack.style.opacity = '1';
            yogaBtn.textContent = "üõë –°–¢–û–ü";
            runYogaCycle();
        } else {
            isYogaMode = false; music.pause(); stage.className = '';
            breathTrack.style.opacity = '0';
            yogaBtn.textContent = "üßò –í–†–ï–ú–ï –ó–ê –ô–û–ì–ê";
        }
    };

   function runYogaCycle() {
    if (!isYogaMode || isDeepMeditation) return;
    yogaCycles++;

    if (yogaCycles > 3) {
        isDeepMeditation = true;
        stage.className = 'meditation';
        document.getElementById('hero-wrap').style.transform = "translateY(0) scale(1)";
        breathTrack.style.opacity = '0';
        msg.innerHTML = "‚ú® –í—ä–ª—à–µ–±–Ω–∞ —Ç–∏—à–∏–Ω–∞... ‚ú®";
        return;
    }

    const wrap = document.getElementById('hero-wrap');
    
    // –í–î–ò–®–ê–ô - –ì–µ—Ä–æ—è—Ç —Å–µ –Ω–∞–¥—É–≤–∞ –∏ –æ—Ç–∏–≤–∞ –Ω–∞–≥–æ—Ä–µ
    msg.innerHTML = "–í–¥–∏—à–∞–π –ø—Ä–µ–∑ –Ω–æ—Å–∞... (" + yogaCycles + "/3)";
    stage.classList.remove('exhale'); stage.classList.add('inhale');
    wrap.style.transform = "translateY(-140px) scale(1.25)"; 
    breathFill.style.height = "100%";

    setTimeout(() => {
        if (!isYogaMode || isDeepMeditation) return;
        // –ò–ó–î–ò–®–ê–ô - –ì–µ—Ä–æ—è—Ç —Å–µ —Å–≤–∏–≤–∞ –∏ —Å–ª–∏–∑–∞ –Ω–∞–¥–æ–ª—É
        msg.innerHTML = "–ò–∑–¥–∏—à–∞–π –ø—Ä–µ–∑ —É—Å—Ç–∞—Ç–∞... (" + yogaCycles + "/3)";
        stage.classList.remove('inhale'); stage.classList.add('exhale');
        wrap.style.transform = "translateY(80px) scale(0.9)"; 
        breathFill.style.height = "0%";
    }, 6000);

    setTimeout(runYogaCycle, 12500);
}
</script>
</body>
</html>